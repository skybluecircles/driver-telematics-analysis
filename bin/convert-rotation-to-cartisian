#!/bin/bash

data=$DTA_DATA

if [ ! $data ]
then
    echo 'Please export DTA_DATA' >&2
    exit 1
fi

for driver in $data/driver/*
do
    for trip in {1..200}
    do
        driver_trip=$driver/trip/$trip

        if [ ! -f $driver_trip/coordinates-cartesian-rotated ]
        then
            cut -f 1 -d, $driver_trip/coordinates-polar \
          | paste -d, - $driver_trip/rotated-homebody-angles \
          | perl -n -F, bin/util/polar-to-cartesian \
          > $driver_trip/coordinates-cartesian-rotated
        fi
    done
done
