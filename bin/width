#!/bin/bash

set -e
set -o pipefail

data=$DTA_DATA

if [ ! $data ]
then
    echo 'Please export DTA_DATA' >&2
    exit 1
fi

for driver in $data/driver/1
do
    for i in {1..200}
    do
        driver_trip=$driver/trip/$i

        if [ ! -f $driver_trip/left-right-indicies ]
        then
            cut -f 1 -d, $driver_trip/coordinates-cartesian-rotated \
          | perl -n bin/util/left-right-indicies \
          > $driver_trip/left-right-indicies
        fi

        if [ ! -f $driver_trip/left-most-point-cartesian ]
        then
            left_index=$( cat $driver_trip/left-right-indicies | cut -f 1 -d, )

            sed -n ${left_index}p $driver_trip/coordinates-cartesian-rotated \
          > $driver_trip/left-most-point-cartesian
        fi

        if [ ! -f $driver_trip/right-most-point-cartesian ]
        then
            right_index=$( cat $driver_trip/left-right-indicies | cut -f 2 -d, )

            sed -n ${right_index}p $driver_trip/coordinates-cartesian-rotated \
          > $driver_trip/right-most-point-cartesian
        fi
    done
done
